<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Writing custom validation functions • hubValidations</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Writing custom validation functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://hubdocs.readthedocs.io/en/latest/" class="external-link"><img src="https://raw.githubusercontent.com/hubverse-org/hubStyle/main/inst/hubverse.png" id="logo" height="30" alt="hubverse"></a>
    <a class="navbar-brand me-2" href="../index.html">hubValidations</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.10.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hub-validations-class.html">Structure of hub_validations class objects</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Validation for hub admins through CI</h6></li>
    <li><a class="dropdown-item" href="../articles/validate-pr.html">Validating Pull Requests on GitHub</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Validation for submitting teams</h6></li>
    <li><a class="dropdown-item" href="../articles/validate-submission.html">Validating submissions locally</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Custom validation checks</h6></li>
    <li><a class="dropdown-item" href="../articles/writing-custom-fns.html">Writing custom validation functions</a></li>
    <li><a class="dropdown-item" href="../articles/deploying-custom-functions.html">Deploying custom validation functions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hubverse-org/hubValidations/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="writing-custom-fns_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="writing-custom-fns_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="writing-custom-fns_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="writing-custom-fns_files/datatables-binding-0.33/datatables.js"></script><link href="writing-custom-fns_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="writing-custom-fns_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="writing-custom-fns_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="writing-custom-fns_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="writing-custom-fns_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Writing custom validation functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hubverse-org/hubValidations/blob/main/vignettes/articles/writing-custom-fns.Rmd" class="external-link"><code>vignettes/articles/writing-custom-fns.Rmd</code></a></small>
      <div class="d-none name"><code>writing-custom-fns.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hubverse-org/hubValidations" class="external-link">hubValidations</a></span><span class="op">)</span></span></code></pre></div>
<p><code>hubValidations</code> provides a wide range of validation
<code>check_*()</code> functions, but there are times when you might
need to write your own custom check functions to check a specific aspect
of your hub’s submissions.</p>
<p>This guide will help you understand how to write custom check
functions and what tools are available in <code>hubValidations</code> to
help.</p>
<p>Custom functions are configured through the
<code>validations.yml</code> file and executed as part of
<code><a href="../reference/validate_model_data.html">validate_model_data()</a></code>,
<code><a href="../reference/validate_model_metadata.html">validate_model_metadata()</a></code> and
<code><a href="../reference/validate_model_file.html">validate_model_file()</a></code> functions. More details about
deploying custom check functions during validation workflows are
available in
<strong><code><a href="../articles/deploying-custom-functions.html">vignette("articles/deploying-custom-functions")</a></code></strong>.</p>
<div class="section level2">
<h2 id="anatomy-of-a-check-function">Anatomy of a check function<a class="anchor" aria-label="anchor" href="#anatomy-of-a-check-function"></a>
</h2>
<p>While source code of existing <code>hubValidations</code>
<code>check_*()</code> functions can be a good place to start when
writing custom check functions, it is important to understand the
structure of a check function, particularly the expected inputs and
outputs.</p>
<p>At it’s most basic, a custom check function should:</p>
<ul>
<li>take in a set of inputs to be validated</li>
<li>evaluate whether a condition is met</li>
<li>return an appropriate check condition object</li>
</ul>
<p>In addition, if the check condition is not met, it’s also helpful to
capture any details that can guide users towards specifics of the
failure and how to fix it</p>
<p>In general, <code>hubValidations</code> check functions evaluate
conditions with respect to one or more of the following:</p>
<ul>
<li>Model output submission files</li>
<li>Model output submission file content (i.e data)</li>
<li>Model metadata files</li>
</ul>
</div>
<div class="section level2">
<h2 id="create_custom_check-for-creating-custom-check-function-templates">
<code>create_custom_check()</code> for creating custom check
function templates<a class="anchor" aria-label="anchor" href="#create_custom_check-for-creating-custom-check-function-templates"></a>
</h2>
<p>To help you get started on the right path, we also provide function
<code><a href="../reference/create_custom_check.html">create_custom_check()</a></code> for creating a basic custom check
function from a template.</p>
<p>The function requires a name for the new custom check function,
e.g. <code>"example_check"</code>. It then creates an <code>.R</code>
script file named after the function (<code>example_check.R</code>) and
saves it in the hub at the recommended location:
<code>src/validations/R/</code>. The script contains basic skeleton code
to create a custom check function called <code>example_check</code>.</p>
<p>The output of <code><a href="../reference/create_custom_check.html">create_custom_check()</a></code> can also be
parametarised through a number of arguments to include additional
template code snippets (see below for examples).</p>
<p>Let’s take a look at the basic structure of a custom check function
created by <code><a href="../reference/create_custom_check.html">create_custom_check()</a></code>.</p>
<p>We’ll start by creating a temporary “hub” for us to work in, but if
you have an existing hub, you can work in there.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hub_path</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/create_custom_check.html">create_custom_check</a></span><span class="op">(</span><span class="st">"cstm_check_tbl_basic"</span>,</span>
<span>  hub_path <span class="op">=</span> <span class="va">hub_path</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Directory <span style="color: #0000BB;">/tmp/RtmpibIK6R/file1e2256f43e4f/src/validations/R</span> created.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Custom validation check template function file <span style="color: #0000BB;">"cstm_check_tbl_basic.R"</span> created.</span></span>
<span><span class="co">#&gt; → Edit the function template to add your custom check logic.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See the <span style="color: #00BB00;">Writing custom check functions</span> article for more information.</span></span>
<span><span class="co">#&gt; (<span style="color: #0000BB; font-style: italic;">&lt;https://hubverse-org.github.io/hubValidations/articles/writing-custom-fns.html&gt;</span>)</span></span></code></pre></div>
<p>The contents of the created file at
<code>src/validations/R/cstm_check_tbl_basic.R</code> are as
follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cstm_check_tbl_basic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Here you can write your custom check logic</span></span>
<span>  <span class="co"># Assign the result as `TRUE` or `FALSE` to object called `check`.</span></span>
<span>  <span class="co"># If `check` is `TRUE`, the check will pass.</span></span>
<span></span>
<span>  <span class="va">check</span> <span class="op">&lt;-</span> <span class="va">condition_to_be_TRUE_for_check_to_pass</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">check</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># You can use details messages to pass on helpful information to users about</span></span>
<span>    <span class="co"># what caused the validation failure and how to locate affected data.</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/format_inline.html" class="external-link">format_inline</a></span><span class="op">(</span><span class="st">"{.var round_id} value {.val invalid} is invalid."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">hubValidations</span><span class="fu">::</span><span class="fu"><a href="../reference/capture_check_cnd.html">capture_check_cnd</a></span><span class="op">(</span></span>
<span>    check <span class="op">=</span> <span class="va">check</span>,</span>
<span>    file_path <span class="op">=</span> <span class="va">file_path</span>,</span>
<span>    msg_subject <span class="op">=</span> <span class="st">"{.var round_id}"</span>,</span>
<span>    msg_attribute <span class="op">=</span> <span class="st">"valid."</span>,</span>
<span>    error <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    details <span class="op">=</span> <span class="va">details</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3 alert alert-info" role="alert">
<h3 id="function-naming-conventions">
<strong>Function naming conventions</strong><a class="anchor" aria-label="anchor" href="#function-naming-conventions"></a>
</h3>
<p>We recommend following the naming conventions used in
<code>hubValidations</code>.</p>
<p>To distinguish <code>hubValidations</code> package functions from
custom ones, we recommend prefixing custom function names with an
additional prefix, e.g. <code>cstm_</code> or <code>cs</code>.</p>
<ul>
<li>
<code>cstm_check_file_*</code> for checks that operate on model
output files (e.g. file location, name etc).</li>
<li>
<code>cstm_check_tbl_*</code> for checks that operate on a tibble of
model output data (i.e. the contents of a file).</li>
<li>
<code>cstm_check_meta_*</code> for checks that operate on model
metadata files.</li>
<li>
<code>cstm_check_submission_*</code> for checks that operate on high
level properties of the submission (e.g. timing).</li>
<li>
<code>cstm_check_config_*</code> for checks that operate on the hub
configuration files.</li>
<li>
<code>cstm_check_valid_*</code> for checks that don’t fit into the
above categories.</li>
</ul>
<p>Neither of these recommendations are required for custom functions to
work, but consistency is an important aspect of maintaining a hub.</p>
</div>
</div>
<div class="section level2">
<h2 id="function-inputs-arguments">Function inputs / arguments<a class="anchor" aria-label="anchor" href="#function-inputs-arguments"></a>
</h2>
<p>The minimum inputs required by a custom check function depend on the
type of check being performed.</p>
<ul>
<li>
<strong><code>file_path</code></strong>: the relative path to the
submission file being validated is required for all check functions.
<strong><code>file_path</code> must therefore be included as an
argument</strong> in all custom check function.</li>
<li>
<strong><code>tbl</code></strong> or
<strong><code>tbl_chr</code></strong>: a <strong>tibble representation
of the contents of a model output</strong> submission—with column data
types matching the hub schema (<code>tbl</code>) or an all character
version (<code>tbl_chr</code>)—is also <strong>required by any checks
that operate on the data</strong> in the submission file.</li>
</ul>
<p>Since <code>file_path</code> and <code>tbl</code> are the most common
inputs to check functions, <code><a href="../reference/create_custom_check.html">create_custom_check()</a></code> includes
them as arguments by default. This means that the <strong>custom check
function will include these objects in the function call environment by
default</strong>.</p>
<div class="alert alert-warning" role="alert">
<p>Keep in mind that <strong><code>tbl</code> and <code>tbl_chr</code>
are only available when calling
<code><a href="../reference/validate_model_data.html">validate_model_data()</a></code></strong>, but not in
<code><a href="../reference/validate_model_metadata.html">validate_model_metadata()</a></code> or
<code><a href="../reference/validate_model_file.html">validate_model_file()</a></code>. Therefore, the default
<code><a href="../reference/create_custom_check.html">create_custom_check()</a></code> function is designed for checks run
by <code><a href="../reference/validate_model_data.html">validate_model_data()</a></code>.</p>
<p><strong>If you’re not running your custom check with
<code><a href="../reference/validate_model_data.html">validate_model_data()</a></code>, you should remove <code>tbl</code>
from the function arguments</strong>. If your custom check not run by
<code><a href="../reference/validate_model_data.html">validate_model_data()</a></code> needs the model output file contents,
you can use <code>hubValidations::read_model_out_file(file_path)</code>
within your function body to read it.</p>
</div>
<p>In addition to these, custom check functions can also have additional
arguments for inputs required by the check. Some of these inputs
<strong>are available in the check caller environment</strong> and can
be passed automatically to a custom check function by including an
argument with the same name as the input object required in the custom
function formals. Other inputs can be passed explicitly to function
arguments through <a href="deploying-custom-functions#validations-yml-structure">the
functions <code>args</code> field</a> when configuring the
<code>validations.yml</code> file.</p>
<div class="section level3">
<h3 id="arguments-available-in-the-caller-environment">Arguments available in the caller environment<a class="anchor" aria-label="anchor" href="#arguments-available-in-the-caller-environment"></a>
</h3>
<p>Each of the <code>validate_*()</code> functions <strong>contain a
number of standard objects in their call environment</strong> which are
<strong>available for downstream check functions to use as
arguments</strong> and are <strong>passed automatically to
arguments</strong> of optional/custom functions <strong>with the same
name</strong>. Therefore, values for such arguments do not need
including in function deployment configuration but <a href="deploying-custom-functions.html#deploying-optional-hubvalidations-functions"><strong>can
be overridden through a function’s <code>args</code>
configuration</strong></a> in <code>validations.yml</code> during
deployment.</p>
<p><strong>All <code>validate_*()</code> functions will contain the
following five objects in their caller environment:</strong></p>
<ul>
<li>
<strong><code>file_path</code></strong>: character string of path to
file being validated relative to the <code>model-output</code>
directory.<br>
</li>
<li>
<strong><code>hub_path</code></strong>: character string of path to
hub.</li>
<li>
<strong><code>round_id</code></strong>: character string of
<code>round_id</code> derived from the model file name.</li>
<li>
<strong><code>file_meta</code></strong>: named list containing
<code>round_id</code>, <code>team_abbr</code>, <code>model_abbr</code>
and <code>model_id</code> details.</li>
<li>
<strong><code>validations_cfg_path</code></strong>: character string
of path to <code>validations.yml</code> file. Defaults to
<code>hub-config/validations.yml</code>.</li>
</ul>
<p><strong><code><a href="../reference/validate_model_data.html">validate_model_data()</a></code> will contain the following
additional objects:</strong></p>
<ul>
<li>
<strong><code>tbl</code></strong>: a tibble of the model output data
being validated.<br>
</li>
<li>
<strong><code>tbl_chr</code></strong>: a tibble of the model output
data being validated with all columns coerced to character type.<br>
</li>
<li>
<strong><code>round_id_col</code></strong>: character string of name
of <code>tbl</code> column containing <code>round_id</code> information.
Defaults to <code>NULL</code> and usually determined from the
<code>tasks.json</code> config if applicable unless explicitly provided
as an argument to <code><a href="../reference/validate_model_data.html">validate_model_data()</a></code>.</li>
<li>
<strong><code>output_type_id_datatype</code></strong>: character
string. The value of the <code>output_type_id_datatype</code> argument.
This value is useful in functions like
<code><a href="https://rdrr.io/pkg/hubData/man/create_hub_schema.html" class="external-link">hubData::create_hub_schema()</a></code> or
<code><a href="../reference/expand_model_out_grid.html">hubValidations::expand_model_out_grid()</a></code> to set the data
type of <code>output_type_id</code> column.</li>
<li>
<strong><code>derived_task_ids</code></strong>: character vector or
<code>NULL</code>. The value of the <code>derived_task_ids</code>
argument, i.e. the names of task IDs whose values depend on other task
IDs.</li>
</ul>
<p>The <code>args</code> configuration can be used to override objects
from the caller environment as well as defaults during deployment.</p>
<div class="alert alert-info" role="alert">
<p>Note that, when writing custom functions, these objects <strong>do
not all need to be specified as arguments</strong> in the function
definition. <strong>Only the ones that your custom function actually
requires as inputs</strong>.</p>
</div>
</div>
<div class="section level3">
<h3 id="additional-arguments">Additional arguments<a class="anchor" aria-label="anchor" href="#additional-arguments"></a>
</h3>
<p>You can add additional arguments to custom check functions and pass
values to them by including them in the <code>args</code> configuration
in the <code>validations.yml</code> file. These values are passed to the
custom check function by <code>hubValidations</code> when the function
is called.</p>
<p>If you do add additional arguments to a custom check function, you
should also add input checks at the start of the function to ensure
inputs are valid. <a href="https://mllg.github.io/checkmate/" class="external-link">The
<code>checkmate</code> package</a> contains a wide range of functions
for checking inputs.</p>
<p>For example, the optional check
<code><a href="../reference/opt_check_tbl_col_timediff.html">opt_check_tbl_col_timediff()</a></code> (which is deployed in exactly
the same fashion as custom functions, i.e. through the
<code>validations.yml</code> file) takes additional arguments
<code>t0_colname</code>, <code>t1_colname</code> and
<code>timediff</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>opt_check_tbl_col_timediff</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="cf">function</span> (tbl, file_path, hub_path, t0_colname, t1_colname, <span class="at">timediff =</span> lubridate<span class="sc">::</span><span class="fu">weeks</span>(<span class="dv">2</span>), </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="at">output_type_id_datatype =</span> <span class="fu">c</span>(<span class="st">"from_config"</span>, <span class="st">"auto"</span>, <span class="st">"character"</span>, </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>        <span class="st">"double"</span>, <span class="st">"integer"</span>, <span class="st">"logical"</span>, <span class="st">"Date"</span>)) </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>{</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_class</span>(timediff, <span class="st">"Period"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_scalar</span>(timediff)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_character</span>(t0_colname, <span class="at">len =</span> <span class="dv">1</span><span class="dt">L</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_character</span>(t1_colname, <span class="at">len =</span> <span class="dv">1</span><span class="dt">L</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_choice</span>(t0_colname, <span class="at">choices =</span> <span class="fu">names</span>(tbl))</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_choice</span>(t1_colname, <span class="at">choices =</span> <span class="fu">names</span>(tbl))</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    config_tasks <span class="ot">&lt;-</span> <span class="fu">read_config</span>(hub_path, <span class="st">"tasks"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    output_type_id_datatype <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">arg_match</span>(output_type_id_datatype)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    schema <span class="ot">&lt;-</span> <span class="fu">create_hub_schema</span>(config_tasks, <span class="at">partitions =</span> <span class="cn">NULL</span>, </span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>        <span class="at">r_schema =</span> <span class="cn">TRUE</span>, <span class="at">output_type_id_datatype =</span> output_type_id_datatype)</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    <span class="fu">assert_column_date</span>(t0_colname, schema)</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    <span class="fu">assert_column_date</span>(t1_colname, schema)</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>    tbl <span class="ot">&lt;-</span> <span class="fu">subset_check_tbl</span>(tbl, <span class="fu">c</span>(t0_colname, t1_colname))</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(tbl) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">capture_check_info</span>(<span class="at">file_path =</span> file_path, <span class="at">msg =</span> <span class="st">"No relevant data to check. Check skipped."</span>))</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>    }</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>lubridate<span class="sc">::</span><span class="fu">is.Date</span>(tbl[[t0_colname]])) {</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>        tbl[, t0_colname] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(tbl[[t0_colname]])</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>    }</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>lubridate<span class="sc">::</span><span class="fu">is.Date</span>(tbl[[t1_colname]])) {</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>        tbl[, t1_colname] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(tbl[[t1_colname]])</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>    }</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>    compare <span class="ot">&lt;-</span> tbl[[t1_colname]] <span class="sc">-</span> tbl[[t0_colname]] <span class="sc">==</span> timediff</span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>    check <span class="ot">&lt;-</span> <span class="fu">all</span>(compare)</span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>    <span class="cf">if</span> (check) {</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>        details <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>    }</span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>        details <span class="ot">&lt;-</span> cli<span class="sc">::</span><span class="fu">format_inline</span>(<span class="st">"t1 var value{?s} {.val {tbl[[t1_colname]][!compare]}} invalid."</span>)</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>    }</span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>    <span class="fu">capture_check_cnd</span>(<span class="at">check =</span> check, <span class="at">file_path =</span> file_path, <span class="at">msg_subject =</span> cli<span class="sc">::</span><span class="fu">format_inline</span>(<span class="st">"Time differences between t0 var {.var {t0_colname}} and t1 var</span><span class="sc">\n</span><span class="st">        {.var {t1_colname}}"</span>), </span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>        <span class="at">msg_verbs =</span> <span class="fu">c</span>(<span class="st">"all match"</span>, <span class="st">"do not all match"</span>), <span class="at">msg_attribute =</span> cli<span class="sc">::</span><span class="fu">format_inline</span>(<span class="st">"expected period of {.val {timediff}}."</span>), </span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>        <span class="at">details =</span> details)</span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>}</span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a><span class="sc">&lt;</span>bytecode<span class="sc">:</span> <span class="dv">0x55c7e46ca4e8</span><span class="sc">&gt;</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a><span class="er">&lt;</span>environment<span class="sc">:</span> namespace<span class="sc">:</span>hubValidations<span class="sc">&gt;</span></span></code></pre></div>
<p>You can add an example extra argument with
<code>extra_args = TRUE</code> when creating the custom check function
with <code><a href="../reference/create_custom_check.html">create_custom_check()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_custom_check.html">create_custom_check</a></span><span class="op">(</span><span class="st">"cstm_check_tbl_args"</span>,</span>
<span>  hub_path <span class="op">=</span> <span class="va">hub_path</span>,</span>
<span>  extra_args <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Custom validation check template function file <span style="color: #0000BB;">"cstm_check_tbl_args.R"</span> created.</span></span>
<span><span class="co">#&gt; → Edit the function template to add your custom check logic.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See the <span style="color: #00BB00;">Writing custom check functions</span> article for more information.</span></span>
<span><span class="co">#&gt; (<span style="color: #0000BB; font-style: italic;">&lt;https://hubverse-org.github.io/hubValidations/articles/writing-custom-fns.html&gt;</span>)</span></span></code></pre></div>
<p>This adds an extra example argument <code>extra_arg</code> to the
custom check function formals as well as an example input check to the
top of the function body.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cstm_check_tbl_args</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span>, <span class="va">file_path</span>, <span class="va">extra_arg</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># If you're providing additional custom arguments, make sure to include input checks</span></span>
<span>  <span class="co"># at the top of your function. `checkmate` package provides a simple interface</span></span>
<span>  <span class="co"># for many useful basic checks and is available through hubValidations.</span></span>
<span>  <span class="co"># The following example checks that `extra_arg` is a single character string.</span></span>
<span>  <span class="fu">checkmate</span><span class="fu">::</span><span class="fu"><a href="https://mllg.github.io/checkmate/reference/checkCharacter.html" class="external-link">assert_character</a></span><span class="op">(</span><span class="va">extra_arg</span>, len <span class="op">=</span> <span class="fl">1L</span>, <span class="va">null.ok</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Here you can write your custom check logic</span></span>
<span>  <span class="co"># Assign the result as `TRUE` or `FALSE` to object called `check`.</span></span>
<span>  <span class="co"># If `check` is `TRUE`, the check will pass.</span></span>
<span></span>
<span>  <span class="va">check</span> <span class="op">&lt;-</span> <span class="va">condition_to_be_TRUE_for_check_to_pass</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">check</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># You can use details messages to pass on helpful information to users about</span></span>
<span>    <span class="co"># what caused the validation failure and how to locate affected data.</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/format_inline.html" class="external-link">format_inline</a></span><span class="op">(</span><span class="st">"{.var round_id} value {.val invalid} is invalid."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">hubValidations</span><span class="fu">::</span><span class="fu"><a href="../reference/capture_check_cnd.html">capture_check_cnd</a></span><span class="op">(</span></span>
<span>    check <span class="op">=</span> <span class="va">check</span>,</span>
<span>    file_path <span class="op">=</span> <span class="va">file_path</span>,</span>
<span>    msg_subject <span class="op">=</span> <span class="st">"{.var round_id}"</span>,</span>
<span>    msg_attribute <span class="op">=</span> <span class="st">"valid."</span>,</span>
<span>    error <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    details <span class="op">=</span> <span class="va">details</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="function-output">Function output<a class="anchor" aria-label="anchor" href="#function-output"></a>
</h2>
<div class="section level3">
<h3 id="capturing-and-returning-check-results-with-capture_check_cnd">Capturing and returning check results with
<code>capture_check_cnd()</code><a class="anchor" aria-label="anchor" href="#capturing-and-returning-check-results-with-capture_check_cnd"></a>
</h3>
<p>The <code><a href="../reference/capture_check_cnd.html">capture_check_cnd()</a></code> function is used to return a
check condition (success, failure, or error) and it’s output is what a
custom check function should return in most cases (see below for
exception). The function returns a <code>&lt;hub_check&gt;</code> class
object depending on the value passed to the <code>check</code> argument,
which represents the summary of the condition being checked by a given
validation function.</p>
<p>If the value passed to <code>check</code> is <code>TRUE</code>, the
function returns a <code>&lt;message/check_success&gt;</code> class
object.</p>
<p>If the value is <code>FALSE</code>, the output depends on the
<code>error</code> argument.</p>
<ul>
<li>If <code>error</code> is <code>FALSE</code> (the default), the
function returns a <code>&lt;error/check_failure&gt;</code> class
object, which indicates the check has failed.</li>
<li>If <code>error</code> is <code>TRUE</code>, the function returns a
<code>&lt;error/check_error&gt;</code> class object, which indicates the
check has failed and additionally causes execution of further custom
validation functions to halt. Set <code>error = TRUE</code> if
downstream checks cannot be run if the current check fails.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_custom_check.html">create_custom_check</a></span><span class="op">(</span><span class="st">"cstm_check_tbl_error"</span>,</span>
<span>  hub_path <span class="op">=</span> <span class="va">hub_path</span>, error <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Custom validation check template function file <span style="color: #0000BB;">"cstm_check_tbl_error.R"</span> created.</span></span>
<span><span class="co">#&gt; → Edit the function template to add your custom check logic.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See the <span style="color: #00BB00;">Writing custom check functions</span> article for more information.</span></span>
<span><span class="co">#&gt; (<span style="color: #0000BB; font-style: italic;">&lt;https://hubverse-org.github.io/hubValidations/articles/writing-custom-fns.html&gt;</span>)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cstm_check_tbl_error</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Here you can write your custom check logic</span></span>
<span>  <span class="co"># Assign the result as `TRUE` or `FALSE` to object called `check`.</span></span>
<span>  <span class="co"># If `check` is `TRUE`, the check will pass.</span></span>
<span></span>
<span>  <span class="va">check</span> <span class="op">&lt;-</span> <span class="va">condition_to_be_TRUE_for_check_to_pass</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">check</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># You can use details messages to pass on helpful information to users about</span></span>
<span>    <span class="co"># what caused the validation failure and how to locate affected data.</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/format_inline.html" class="external-link">format_inline</a></span><span class="op">(</span><span class="st">"{.var round_id} value {.val invalid} is invalid."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">hubValidations</span><span class="fu">::</span><span class="fu"><a href="../reference/capture_check_cnd.html">capture_check_cnd</a></span><span class="op">(</span></span>
<span>    check <span class="op">=</span> <span class="va">check</span>,</span>
<span>    file_path <span class="op">=</span> <span class="va">file_path</span>,</span>
<span>    msg_subject <span class="op">=</span> <span class="st">"{.var round_id}"</span>,</span>
<span>    msg_attribute <span class="op">=</span> <span class="st">"valid."</span>,</span>
<span>    error <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    details <span class="op">=</span> <span class="va">details</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="skipping-checks-and-returning-a-message-with-capture_check_info">Skipping checks and returning a message with
<code>capture_check_info()</code><a class="anchor" aria-label="anchor" href="#skipping-checks-and-returning-a-message-with-capture_check_info"></a>
</h3>
<p>Sometimes a check function might not always be applicable and a
pre-condition needs to be met before the main check itself is performed.
<strong>If the pre-condition is not met, the check is usually
skipped</strong>.</p>
<p><strong>For such checks, the function should return a
<code>&lt;message/check_info&gt;</code> object</strong>, generated by
the <code><a href="../reference/capture_check_info.html">capture_check_info()</a></code> function. Use the <code>msg</code>
argument to explain that a check was skipped and why.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/capture_check_info.html">capture_check_info</a></span><span class="op">(</span></span>
<span>  <span class="st">"modelA-teamA/2024-09-12-modelA-teamA"</span>,</span>
<span>  <span class="st">"Condition for running this check was not met. Skipped."</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">&lt;message/check_info&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Message</span><span style="font-weight: bold;">:</span></span></span>
<span><span class="co">#&gt; Condition for running this check was not met. Skipped.</span></span></code></pre></div>
<p>For example, the <code><a href="../reference/check_tbl_value_col_ascending.html">check_tbl_value_col_ascending()</a></code> check
function which validates that values are ascending when arranged by
increasing <code>output_type_id</code> order is only applicable to
<code>cdf</code> and <code>quantile</code> output types. Before
proceeding with the main check, the function first checks whether the
model output <code>tbl</code> contains data for <code>cdf</code> and
<code>quantile</code> output types. If not, the check is skipped.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>check_tbl_value_col_ascending</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="cf">function</span> (tbl, file_path) </span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>{</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(<span class="sc">!</span><span class="fu">c</span>(<span class="st">"cdf"</span>, <span class="st">"quantile"</span>) <span class="sc">%in%</span> tbl[[<span class="st">"output_type"</span>]])) {</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">capture_check_info</span>(file_path, <span class="st">"No quantile or cdf output types to check for non-descending values.</span><span class="sc">\n</span><span class="st">        Check skipped."</span>))</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    }</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    output_type_tbl <span class="ot">&lt;-</span> <span class="fu">split</span>(tbl, tbl[[<span class="st">"output_type"</span>]])[<span class="fu">c</span>(<span class="st">"cdf"</span>, </span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>        <span class="st">"quantile"</span>)] <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">compact</span>()</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    error_tbl <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(output_type_tbl, check_values_ascending) <span class="sc">%&gt;%</span> </span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">list_rbind</span>()</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    check <span class="ot">&lt;-</span> <span class="fu">nrow</span>(error_tbl) <span class="sc">==</span> <span class="dv">0</span><span class="dt">L</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>    <span class="cf">if</span> (check) {</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>        details <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>        error_tbl <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>    }</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>        details <span class="ot">&lt;-</span> cli<span class="sc">::</span><span class="fu">format_inline</span>(<span class="st">"See {.var error_tbl} attribute for details."</span>)</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>    }</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>    <span class="fu">capture_check_cnd</span>(<span class="at">check =</span> check, <span class="at">file_path =</span> file_path, <span class="at">msg_subject =</span> <span class="st">"Values in {.var value} column"</span>, </span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>        <span class="at">msg_verbs =</span> <span class="fu">c</span>(<span class="st">"are non-decreasing"</span>, <span class="st">"are not non-decreasing"</span>), </span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>        <span class="at">msg_attribute =</span> <span class="st">"as output_type_ids increase for all unique task ID</span><span class="sc">\n</span><span class="st">    value/output type combinations of quantile or cdf output types."</span>, </span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>        <span class="at">details =</span> details, <span class="at">error_tbl =</span> error_tbl)</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>}</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="sc">&lt;</span>bytecode<span class="sc">:</span> <span class="dv">0x55c7e6944088</span><span class="sc">&gt;</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="er">&lt;</span>environment<span class="sc">:</span> namespace<span class="sc">:</span>hubValidations<span class="sc">&gt;</span></span></code></pre></div>
<p>You can add a pre-condition check block of code with argument
<code>conditional = TRUE</code> when creating the custom check function
with <code><a href="../reference/create_custom_check.html">create_custom_check()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_custom_check.html">create_custom_check</a></span><span class="op">(</span><span class="st">"cstm_check_tbl_skip"</span>,</span>
<span>  hub_path <span class="op">=</span> <span class="va">hub_path</span>,</span>
<span>  conditional <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Custom validation check template function file <span style="color: #0000BB;">"cstm_check_tbl_skip.R"</span> created.</span></span>
<span><span class="co">#&gt; → Edit the function template to add your custom check logic.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See the <span style="color: #00BB00;">Writing custom check functions</span> article for more information.</span></span>
<span><span class="co">#&gt; (<span style="color: #0000BB; font-style: italic;">&lt;https://hubverse-org.github.io/hubValidations/articles/writing-custom-fns.html&gt;</span>)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cstm_check_tbl_skip</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">condition</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/capture_check_info.html">capture_check_info</a></span><span class="op">(</span></span>
<span>        <span class="va">file_path</span>,</span>
<span>        <span class="st">"Condition for running this check was not met. Skipped."</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Here you can write your custom check logic</span></span>
<span>  <span class="co"># Assign the result as `TRUE` or `FALSE` to object called `check`.</span></span>
<span>  <span class="co"># If `check` is `TRUE`, the check will pass.</span></span>
<span></span>
<span>  <span class="va">check</span> <span class="op">&lt;-</span> <span class="va">condition_to_be_TRUE_for_check_to_pass</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">check</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># You can use details messages to pass on helpful information to users about</span></span>
<span>    <span class="co"># what caused the validation failure and how to locate affected data.</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/format_inline.html" class="external-link">format_inline</a></span><span class="op">(</span><span class="st">"{.var round_id} value {.val invalid} is invalid."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">hubValidations</span><span class="fu">::</span><span class="fu"><a href="../reference/capture_check_cnd.html">capture_check_cnd</a></span><span class="op">(</span></span>
<span>    check <span class="op">=</span> <span class="va">check</span>,</span>
<span>    file_path <span class="op">=</span> <span class="va">file_path</span>,</span>
<span>    msg_subject <span class="op">=</span> <span class="st">"{.var round_id}"</span>,</span>
<span>    msg_attribute <span class="op">=</span> <span class="st">"valid."</span>,</span>
<span>    error <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    details <span class="op">=</span> <span class="va">details</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="loading-config-files">Loading config files<a class="anchor" aria-label="anchor" href="#loading-config-files"></a>
</h2>
<p>Many checks are conditioned against information stored in hub
configuration files and these are often read in at the start of the
custom check function.</p>
<p>The easiest way to make hub configuration information available
within your function is to pass the <code>hub_path</code> caller
environment object by specifying it as a function argument and then use
<code>hubUtils::read_config(hub_path)</code> to read in the
<code>tasks.json</code> configuration file.</p>
<p>You can add a <code>config = TRUE</code> argument when creating the
custom check function with <code><a href="../reference/create_custom_check.html">create_custom_check()</a></code> to include
the <code>hub_path</code> argument and insert a code snippet in you
custom check function skeleton that reads in the <code>tasks.json</code>
hub configuration file.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_custom_check.html">create_custom_check</a></span><span class="op">(</span><span class="st">"cstm_check_tbl_config"</span>,</span>
<span>  hub_path <span class="op">=</span> <span class="va">hub_path</span>,</span>
<span>  config <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Custom validation check template function file <span style="color: #0000BB;">"cstm_check_tbl_config.R"</span> created.</span></span>
<span><span class="co">#&gt; → Edit the function template to add your custom check logic.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See the <span style="color: #00BB00;">Writing custom check functions</span> article for more information.</span></span>
<span><span class="co">#&gt; (<span style="color: #0000BB; font-style: italic;">&lt;https://hubverse-org.github.io/hubValidations/articles/writing-custom-fns.html&gt;</span>)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cstm_check_tbl_config</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span>, <span class="va">file_path</span>, <span class="va">hub_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">config_tasks</span> <span class="op">&lt;-</span> <span class="fu">hubValidations</span><span class="fu">::</span><span class="fu"><a href="https://hubverse-org.github.io/hubUtils/reference/read_config.html" class="external-link">read_config</a></span><span class="op">(</span><span class="va">hub_path</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Here you can write your custom check logic</span></span>
<span>  <span class="co"># Assign the result as `TRUE` or `FALSE` to object called `check`.</span></span>
<span>  <span class="co"># If `check` is `TRUE`, the check will pass.</span></span>
<span></span>
<span>  <span class="va">check</span> <span class="op">&lt;-</span> <span class="va">condition_to_be_TRUE_for_check_to_pass</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">check</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># You can use details messages to pass on helpful information to users about</span></span>
<span>    <span class="co"># what caused the validation failure and how to locate affected data.</span></span>
<span>    <span class="va">details</span> <span class="op">&lt;-</span> <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/format_inline.html" class="external-link">format_inline</a></span><span class="op">(</span><span class="st">"{.var round_id} value {.val invalid} is invalid."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">hubValidations</span><span class="fu">::</span><span class="fu"><a href="../reference/capture_check_cnd.html">capture_check_cnd</a></span><span class="op">(</span></span>
<span>    check <span class="op">=</span> <span class="va">check</span>,</span>
<span>    file_path <span class="op">=</span> <span class="va">file_path</span>,</span>
<span>    msg_subject <span class="op">=</span> <span class="st">"{.var round_id}"</span>,</span>
<span>    msg_attribute <span class="op">=</span> <span class="st">"valid."</span>,</span>
<span>    error <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    details <span class="op">=</span> <span class="va">details</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-function-dependencies">Custom function dependencies<a class="anchor" aria-label="anchor" href="#custom-function-dependencies"></a>
</h2>
<p>When writing your functions you might want to use functions from
other packages.</p>
</div>
<div class="section level2">
<h2 id="available-dependencies">Available dependencies<a class="anchor" aria-label="anchor" href="#available-dependencies"></a>
</h2>
<p><strong>All <code>hubValidations</code> exported functions are
available</strong> for use in your custom check functions as well as
functions from hubverse packages <strong><code>huUtils</code></strong>,
<strong><code>hubAdmin</code></strong> and
<strong><code>hubData</code></strong>.</p>
<p>In addition, <strong>functions in packages from the
<code>hubValidations</code> dependency tree are also generally
available</strong>, both locally (once <code>hubValidations</code> is
installed) and in the hubverse <code>validate-submission</code> GitHub
Action.</p>
<p>Functions from these packages can be used in your custom checks
without specifying them as additional dependencies.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"data":[["arrow","askpass","assertthat","backports","base64enc","base64url","bigD","bit","bit64","bitops","bslib","cachem","checkmate","cli","clipr","colorspace","commonmark","config","crayon","curl","data.table","digest","dplyr","evaluate","fansi","farver","fastmap","fontawesome","fs","generics","gh","gitcreds","glue","gt","highr","hms","htmltools","htmlwidgets","httr","httr2","hubAdmin","hubData","hubUtils","hubValidations","ini","jquerylib","jsonlite","jsonvalidate","juicyjuice","knitr","labeling","lifecycle","lubridate","magrittr","markdown","memoise","mime","MMWRweek","munsell","openssl","pillar","pkgconfig","purrr","R6","rappdirs","RColorBrewer","Rcpp","reactable","reactR","readr","rlang","rmarkdown","sass","scales","stringi","stringr","sys","tibble","tidyselect","timechange","tinytex","tzdb","utf8","V8","vctrs","viridisLite","vroom","whisker","withr","xfun","xml2","yaml","zoltr"],["18.1.0","1.2.1","0.2.1","1.5.0","0.1-3","1.4","0.3.0","4.5.0.1","4.5.2","1.0-9","0.8.0","1.1.0","2.3.2","3.6.3","0.8.0","2.1-1","1.9.2","0.3.2","1.5.3","6.0.1","1.16.4","0.6.37","1.1.4","1.0.1","1.0.6","2.1.2","1.2.0","0.5.3","1.6.5","0.1.3","1.4.1","0.1.2","1.8.0","0.11.1","0.11","1.1.3","0.5.8.1","1.6.4","1.4.7","1.0.7","1.4.0.9000","1.3.0.9000","0.3.0.9000","0.10.0","0.3.1","0.1.4","1.8.9","1.3.2","0.1.0","1.49","0.4.3","1.0.4","1.9.4","2.0.3","1.13","2.0.1","0.12","0.1.3","0.5.1","2.2.2","1.9.0","2.0.3","1.0.2","2.5.1","0.3.3","1.1-3","1.0.13-1","0.4.4","0.6.1","2.1.5","1.1.4","2.29","0.4.9","1.3.0","1.8.4","1.5.1","3.4.3","3.2.1","1.2.1","0.3.0","0.54","0.4.0","1.2.4","6.0.0","0.6.5","0.4.2","1.6.5","0.4.1","3.0.2","0.49","1.3.6","2.3.10","1.0.1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>package<\/th>\n      <th>version<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"name":"package","targets":0},{"name":"version","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level2">
<h2 id="additional-dependencies">Additional dependencies<a class="anchor" aria-label="anchor" href="#additional-dependencies"></a>
</h2>
<p>If any custom functions you are deploying depend on additional
packages, you will need to ensure these packages are available during
validation.</p>
<p>The simplest way to ensure they are available is to edit the
<code>setup-r-dependencies</code> step in the
<code>hubverse-actions</code> <a href="https://github.com/hubverse-org/hubverse-actions/blob/main/validate-submission/validate-submission.yaml" class="external-link"><code>validate-submission.yaml</code></a>
GitHub Action workflow of your hub and add any additional dependency to
the <code>packages</code> field list.</p>
<p>In the following pseudo example we add <code>additionalPackage</code>
package to the list of standard dependencies:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r-dependencies@v2</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">          packages</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>            any::hubValidations</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>            any::sessioninfo</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>            any::additionalPackage</span></code></pre></div>
<p>Note that this ensures the additional dependency is available during
validation on GitHub but does not guarantee it will be installed locally
for hub administrators or submitting teams. Indeed such missing
dependencies could lead to execution errors in custom checks when
running <code><a href="../reference/validate_submission.html">validate_submission()</a></code> locally.</p>
<p>You could use documentation, like your hub’s README to communicate
additional required dependencies for validation to submitting teams.
Even better, you could add a check to the top of your function to catch
missing dependencies and provide a helpful error message to the
user.</p>
</div>
<div class="section level2">
<h2 id="managing-custom-check-functions-as-a-package">Managing custom check functions as a package<a class="anchor" aria-label="anchor" href="#managing-custom-check-functions-as-a-package"></a>
</h2>
<p>The simplest way to manage custom check functions is to store them as
scripts in the <code>src/validations/R</code> directory in the root of
the hub and source them during validation by specifying the path to a
custom functions file via the <code>source:</code> property in
<code>validations.yml</code>.</p>
<p>Alternatively, you could <strong>manage your custom functions as a
package</strong>.</p>
<p>You can easily <a href="https://r-pkgs.org/whole-game.html#create_package" class="external-link">turn the
contents of <code>src/validations</code> into a local
<code>validations</code> R package</a> with:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">create_package</a></span><span class="op">(</span><span class="st">"src/validations"</span>, open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>This would allow you to:</p>
<ul>
<li>Make your functions available locally by users who could use
<code>pak::local_install("src/validations")</code> in the hub root to
install the <code>validations</code> package.</li>
<li>
<a href="https://r-pkgs.org/description.html#sec-description-imports-suggests" class="external-link">Manage
additional dependencies</a> required by your custom functions formally
through the <code>DESCRIPTION</code> file.</li>
<li>
<a href="https://r-pkgs.org/testing-basics.html" class="external-link">Formally test your
custom functions</a> using <code>testthat</code> tests in the
<code>tests/testthat</code> directory.</li>
</ul>
<div class="section level3">
<h3 id="deploying-custom-functions-as-a-package">Deploying custom functions as a package<a class="anchor" aria-label="anchor" href="#deploying-custom-functions-as-a-package"></a>
</h3>
<p>To deploy custom functions managed as a package in
<code>src/validations</code>, you can use the <code>pkg</code>
configuration property in the <code>validations.yml</code> file to
specify the package namespace.</p>
<p>For example, if you have created a simple package in
<code>src/validations/</code> with a
<code>cstm_check_tbl_example.R</code> script containing the
specification of an <code>cstm_check_tbl_example()</code> function in
<code>src/validations/R</code>, you can use the following configuration
in your <code>validation.yml</code> file to source the function from the
installed <code>validations</code> package namespace:</p>
<pre><code><span><span class="va">default</span><span class="op">:</span></span>
<span>    <span class="va">validate_model_data</span><span class="op">:</span></span>
<span>      <span class="va">custom_check</span><span class="op">:</span></span>
<span>        <span class="va">fn</span><span class="op">:</span> <span class="st">"cstm_check_tbl_example"</span></span>
<span>        <span class="va">pkg</span><span class="op">:</span> <span class="st">"validations"</span></span></code></pre>
<p>To ensure the package (and any additional dependencies it depends on)
is installed and available during validation, you must add the package
to the <code>setup-r-dependencies</code> step in the
<code>hubverse-actions</code> <code>validate-submission.yaml</code>
GitHub Action workflow of your hub like so:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r-dependencies@v2</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="fu">          packages</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>            any::hubValidations</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>            any::sessioninfo</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>            local::./src/validations</span></code></pre></div>
<p>If you want to share custom functions across multiple hubs, you could
even consider separating them into a standalone package and hosting them
on GitHub.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anna Krystalli, Evan Ray, Hugo Gruson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1. PR Previews built by <a href="https://www.netlify.com" class="external-link">Netlify</a>. Provided without <strong>any warranty</strong>.</p>
</div>

    </footer>
</div>





  </body>
</html>
