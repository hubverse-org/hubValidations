<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Deploying custom validation functions • hubValidations</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deploying custom validation functions">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://hubdocs.readthedocs.io/en/latest/" class="external-link"><img src="https://raw.githubusercontent.com/hubverse-org/hubStyle/main/inst/hubverse.png" id="logo" height="30" alt="hubverse"></a>
    <a class="navbar-brand me-2" href="../index.html">hubValidations</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.7.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hub-validations-class.html">Structure of hub_validations class objects</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Validation for hub admins through CI</h6></li>
    <li><a class="dropdown-item" href="../articles/validate-pr.html">Validating Pull Requests on GitHub</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Validation for submitting teams</h6></li>
    <li><a class="dropdown-item" href="../articles/validate-submission.html">Validating submissions locally</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Custom validation checks</h6></li>
    <li><a class="dropdown-item" href="../articles/writing-custom-fns.html">Writing custom validation functions</a></li>
    <li><a class="dropdown-item" href="../articles/deploying-custom-functions.html">Deploying custom validation functions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hubverse-org/hubValidations/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="deploying-custom-functions_files/kePrint-0.0.1/kePrint.js"></script><link href="deploying-custom-functions_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="deploying-custom-functions_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="deploying-custom-functions_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="deploying-custom-functions_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="deploying-custom-functions_files/datatables-binding-0.33/datatables.js"></script><link href="deploying-custom-functions_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="deploying-custom-functions_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="deploying-custom-functions_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="deploying-custom-functions_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="deploying-custom-functions_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Deploying custom validation functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hubverse-org/hubValidations/blob/main/vignettes/articles/deploying-custom-functions.Rmd" class="external-link"><code>vignettes/articles/deploying-custom-functions.Rmd</code></a></small>
      <div class="d-none name"><code>deploying-custom-functions.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hubverse-org/hubValidations" class="external-link">hubValidations</a></span><span class="op">)</span></span></code></pre></div>
<p>Custom validation functions can be included and configured within
standard <code>hubValidation</code> workflows by <strong>including a
<code>validations.yml</code> file in the <code>hub-config</code>
directory</strong>. Alternatively, an appropriately structured file can
be included at a different location and the path to the file provided
through argument <code>validations_cfg_path</code>.</p>
<p><code>hubValidations</code> uses the <a href="https://rstudio.github.io/config/articles/inheritance.html" class="external-link"><code>config</code></a>
package to get validation configuration. This allows for configuration
inheritance and the ability to include executable R code. See the
<code>config</code> package vignette on <a href="https://rstudio.github.io/config/articles/inheritance.html" class="external-link">inheritance
and R expressions</a> for more details.</p>
<div class="section level3">
<h3 id="validations-yml-structure">
<code>validations.yml</code> structure<a class="anchor" aria-label="anchor" href="#validations-yml-structure"></a>
</h3>
<p><code>validations.yml</code> files should follow the nested structure
described below:</p>
<div class="section level4">
<h4 id="default-configuration">Default configuration<a class="anchor" aria-label="anchor" href="#default-configuration"></a>
</h4>
<p>The top of any <code>validations.yml</code> file, under the required
<code>default:</code> top level property, should contain default custom
validation configurations that will be executed regardless of round
ID.</p>
<p>Within the default configuration, individual checks can be configured
for each of the 3 validation functions run as part of
<code><a href="../reference/validate_submission.html">validate_submission()</a></code>, using the following structure for
each validation function:</p>
<ul>
<li>
<strong><code>&lt;name-of-caller-function&gt;</code>:</strong> One
of <code>validate_model_data</code>,
<code>validate_model_metadata</code> and
<code>validate_model_file</code> depending on the function the custom
check is to be included in.
<ul>
<li>
<strong><code>&lt;name-of-check&gt;</code>:</strong> The name of the
check. This is the name of the element containing the result of the
check when <code>hub_validations</code> is returned (required).
<ul>
<li>
<strong><code>fn</code>:</strong> The name of the check function to
be run, as character string (required).</li>
<li>
<strong><code>pkg</code>:</strong> The name of the package namespace
from which to get check function. Must be supplied if function is
distributed as part of a package.</li>
<li>
<strong><code>source:</code></strong> Path to <code>.R</code> script
containing function code to be sourced. If relative, should be relative
to the hub’s directory root. Must be supplied if function is not part of
a package and only exists as a script.</li>
<li>
<strong><code>args</code>:</strong> A yaml dictionary of key/value
pairs of arguments and their values to be passed to the custom function.
Values can be yaml lists or even executable R code (optional).</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Each of the <code>validate_*()</code> functions <strong>contain a
number of standard objects in their call environment</strong> which are
<strong>available for downstream check functions to use as
arguments</strong> and are <strong>passed automatically to
arguments</strong> of optional/custom functions <strong>with the same
name</strong>. Therefore, values for such arguments do not need
including in function deployment configuration but <a href="deploying-custom-functions.html#deploying-optional-hubvalidations-functions"><strong>can
be overridden through a function’s <code>args</code>
configuration</strong></a> in <code>validations.yml</code> during
deployment.</p>
<p><strong>All <code>validate_*()</code> functions will contain the
following five objects in their caller environment:</strong></p>
<ul>
<li>
<strong><code>file_path</code></strong>: character string of path to
file being validated relative to the <code>model-output</code>
directory.<br>
</li>
<li>
<strong><code>hub_path</code></strong>: character string of path to
hub.</li>
<li>
<strong><code>round_id</code></strong>: character string of
<code>round_id</code> derived from the model file name.</li>
<li>
<strong><code>file_meta</code></strong>: named list containing
<code>round_id</code>, <code>team_abbr</code>, <code>model_abbr</code>
and <code>model_id</code> details.</li>
<li>
<strong><code>validations_cfg_path</code></strong>: character string
of path to <code>validations.yml</code> file. Defaults to
<code>hub-config/validations.yml</code>.</li>
</ul>
<p><strong><code><a href="../reference/validate_model_data.html">validate_model_data()</a></code> will contain the following
additional objects:</strong></p>
<ul>
<li>
<strong><code>tbl</code></strong>: a tibble of the model output data
being validated.<br>
</li>
<li>
<strong><code>tbl_chr</code></strong>: a tibble of the model output
data being validated with all columns coerced to character type.<br>
</li>
<li>
<strong><code>round_id_col</code></strong>: character string of name
of <code>tbl</code> column containing <code>round_id</code> information.
Defaults to <code>NULL</code> and usually determined from the
<code>tasks.json</code> config if applicable unless explicitly provided
as an argument to <code><a href="../reference/validate_model_data.html">validate_model_data()</a></code>.</li>
<li>
<strong><code>output_type_id_datatype</code></strong>: character
string. The value of the <code>output_type_id_datatype</code> argument.
This value is useful in functions like
<code><a href="https://rdrr.io/pkg/hubData/man/create_hub_schema.html" class="external-link">hubData::create_hub_schema()</a></code> or
<code><a href="../reference/expand_model_out_grid.html">hubValidations::expand_model_out_grid()</a></code> to set the data
type of <code>output_type_id</code> column.</li>
<li>
<strong><code>derived_task_ids</code></strong>: character vector or
<code>NULL</code>. The value of the <code>derived_task_ids</code>
argument, i.e. the names of task IDs whose values depend on other task
IDs.</li>
</ul>
<p>The <code>args</code> configuration can be used to override objects
from the caller environment as well as defaults during deployment.</p>
<div class="section level5">
<h5 id="deploying-optional-hubvalidations-functions">Deploying optional <code>hubValidations</code> functions<a class="anchor" aria-label="anchor" href="#deploying-optional-hubvalidations-functions"></a>
</h5>
<p>Here’s an example configuration for a single optional
<code>hubValidations</code> check,
<code><a href="../reference/opt_check_tbl_horizon_timediff.html">opt_check_tbl_horizon_timediff()</a></code>, which checks that the
temporal difference between the values in two date columns (defined by
additional arguments <code>t0_colname</code> &amp;
<code>t1_colname</code>) is equal to a time period defined by horizon
values (contained in a column defined by <code>horizon_colname</code>)
and the length of a single horizon defined by argument
<code>timediff</code>.</p>
<p>The check is to be run as part of the
<code><a href="../reference/validate_model_data.html">validate_model_data()</a></code> validation function which checks the
content of the model data submission files.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default</span><span class="op">:</span></span>
<span>    <span class="va">validate_model_data</span><span class="op">:</span></span>
<span>      <span class="va">horizon_timediff</span><span class="op">:</span></span>
<span>        <span class="va">fn</span><span class="op">:</span> <span class="st">"opt_check_tbl_horizon_timediff"</span></span>
<span>        <span class="va">pkg</span><span class="op">:</span> <span class="st">"hubValidations"</span></span>
<span>        <span class="va">args</span><span class="op">:</span></span>
<span>          <span class="va">t0_colname</span><span class="op">:</span> <span class="st">"forecast_date"</span></span>
<span>          <span class="va">t1_colname</span><span class="op">:</span> <span class="st">"target_end_date"</span></span></code></pre></div>
<p>The above configuration file relies on default values for arguments
<code>horizon_colname</code> (<code>"horizon"</code>) and
<code>timediff</code> (<code><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">lubridate::weeks()</a></code>). We can
<strong>use the <code>validations.yml</code> <code>args</code> list to
override the <code>horizon_colname</code> and <code>timediff</code>
argument default values</strong>.</p>
<p>In this example, we <strong>also include executable r code</strong>
as the value of the <code>timediff</code> argument.</p>
<pre><code>default:
    validate_model_data:
      horizon_timediff:
        fn: "opt_check_tbl_horizon_timediff"
        pkg: "hubValidations"
        args:
          t0_colname: "forecast_date"
          t1_colname: "target_end_date"
          horizon_colname: "horizons"
          timediff: !expr lubridate::weeks(2)</code></pre>
</div>
<div class="section level5">
<h5 id="deploying-custom-functions">Deploying custom functions<a class="anchor" aria-label="anchor" href="#deploying-custom-functions"></a>
</h5>
<p>The above example involved an optional <code>hubValidation</code>
function. To deploy a custom function that is not part of the
<code>hubValidations</code> or any other package, you should store the
script containing the function in the <code>src/validations/R/</code>
directory (relative to the root of your hub) and include the path to the
script in the <code>source</code> argument in the configuration
file.</p>
<pre><code><span><span class="va">default</span><span class="op">:</span></span>
<span>    <span class="va">validate_model_data</span><span class="op">:</span></span>
<span>      <span class="va">custom_check</span><span class="op">:</span></span>
<span>        <span class="va">fn</span><span class="op">:</span> <span class="st">"cstm_check_tbl_example"</span></span>
<span>        <span class="va">source</span><span class="op">:</span> <span class="st">"src/validations/R/cstm_check_tbl_example.R"</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="round-specific-configuration">Round specific configuration<a class="anchor" aria-label="anchor" href="#round-specific-configuration"></a>
</h4>
<p>Additional round specific configurations can be included in
<code>validations.yml</code> that can add to or override default
configurations.</p>
<p>For example, in the following <code>validations.yml</code> which
deploys the <code><a href="../reference/opt_check_tbl_col_timediff.html">opt_check_tbl_col_timediff()</a></code> optional check, if
the file being validated is being submitted to a round with round ID
<code>"2023-08-15"</code>, default <code>col_timediff</code> check
configuration will be overridden by the <code>2023-08-15</code>
configuration.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">default</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="at">    </span><span class="fu">validate_model_data</span><span class="kw">:</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="at">      </span><span class="fu">col_timediff</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="at">        </span><span class="fu">fn</span><span class="kw">:</span><span class="at"> </span><span class="st">"opt_check_tbl_col_timediff"</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="at">        </span><span class="fu">pkg</span><span class="kw">:</span><span class="at"> </span><span class="st">"hubValidations"</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="at">        </span><span class="fu">args</span><span class="kw">:</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="at">          </span><span class="fu">t0_colname</span><span class="kw">:</span><span class="at"> </span><span class="st">"forecast_date"</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="at">          </span><span class="fu">t1_colname</span><span class="kw">:</span><span class="at"> </span><span class="st">"target_end_date"</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="fu">2023-08-15</span><span class="kw">:</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="at">    </span><span class="fu">validate_model_data</span><span class="kw">:</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="at">      </span><span class="fu">col_timediff</span><span class="kw">:</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="at">        </span><span class="fu">fn</span><span class="kw">:</span><span class="at"> </span><span class="st">"opt_check_tbl_col_timediff"</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="at">        </span><span class="fu">pkg</span><span class="kw">:</span><span class="at"> </span><span class="st">"hubValidations"</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="at">        </span><span class="fu">args</span><span class="kw">:</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="at">          </span><span class="fu">t0_colname</span><span class="kw">:</span><span class="at"> </span><span class="st">"forecast_date"</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="at">          </span><span class="fu">t1_colname</span><span class="kw">:</span><span class="at"> </span><span class="st">"target_end_date"</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="at">          </span><span class="fu">timediff</span><span class="kw">:</span><span class="at"> !expr lubridate::weeks(1)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="available-optional-functions">Available optional functions<a class="anchor" aria-label="anchor" href="#available-optional-functions"></a>
</h3>
<p><code>hubValidations</code> includes a number of optional checks or
checks that require administrator configuration to be run, detailed
below.</p>
<p>For more detail on each function and its configuration parameters,
consult the function documentation.</p>
<div class="section level4">
<h4 id="for-deploying-through-validate_model_data">For deploying through <code>validate_model_data</code><a class="anchor" aria-label="anchor" href="#for-deploying-through-validate_model_data"></a>
</h4>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Details of available optional checks or checks requiring configuration
for <code><a href="../reference/validate_model_data.html">validate_model_data()</a></code>.
</caption>
<thead><tr>
<th style="text-align:left;">
check fun
</th>
<th style="text-align:left;">
Check
</th>
<th style="text-align:left;">
Early return
</th>
<th style="text-align:left;">
Fail output
</th>
<th style="text-align:left;">
Extra info
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
opt_check_tbl_col_timediff
</td>
<td style="text-align:left;">
Time difference between values in two date columns equal a defined
period.
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
check_failure
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
opt_check_tbl_counts_lt_popn
</td>
<td style="text-align:left;">
Predicted values per location are less than total location population.
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
check_failure
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
opt_check_tbl_horizon_timediff
</td>
<td style="text-align:left;">
Time difference between values in two date columns equals a defined time
period defined by values in a horizon column.
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
check_failure
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="for-deploying-through-validate_model_metadata">For deploying through <code>validate_model_metadata</code><a class="anchor" aria-label="anchor" href="#for-deploying-through-validate_model_metadata"></a>
</h4>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Details of available optional checks or checks requiring configuration
for <code><a href="../reference/validate_model_metadata.html">validate_model_metadata()</a></code>.
</caption>
<thead><tr>
<th style="text-align:left;">
check fun
</th>
<th style="text-align:left;">
Check
</th>
<th style="text-align:left;">
Early return
</th>
<th style="text-align:left;">
Fail output
</th>
<th style="text-align:left;">
Extra info
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;font-weight: bold;">
opt_check_metadata_team_max_model_n
</td>
<td style="text-align:left;">
The number of metadata files submitted by a single team does not exceed
the maximum number allowed.
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
check_failure
</td>
<td style="text-align:left;">
</td>
</tr></tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="managing-dependencies-of-custom-functions">Managing dependencies of custom functions<a class="anchor" aria-label="anchor" href="#managing-dependencies-of-custom-functions"></a>
</h2>
<p>If any custom functions you are deploying depend on additional
packages, you will need to ensure these packages are available during
validation.</p>
<div class="section level3">
<h3 id="available-dependencies">Available dependencies<a class="anchor" aria-label="anchor" href="#available-dependencies"></a>
</h3>
<p><strong>All <code>hubValidations</code> exported functions are
available</strong> for use in your custom check functions as well as
functions from hubverse packages <strong><code>huUtils</code></strong>,
<strong><code>hubAdmin</code></strong> and
<strong><code>hubData</code></strong>.</p>
<p>In addition, <strong>functions in packages from the
<code>hubValidations</code> dependency tree are also generally
available</strong>, both locally (once <code>hubValidations</code> is
installed) and in the hubverse <code>validate-submission</code> GitHub
Action.</p>
<p>Functions from these packages can be used in your custom checks
without specifying them as additional dependencies.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"data":[["arrow","askpass","assertthat","backports","base64enc","base64url","bigD","bit","bit64","bitops","bslib","cachem","checkmate","cli","clipr","colorspace","commonmark","config","crayon","curl","data.table","digest","dplyr","evaluate","fansi","farver","fastmap","fontawesome","fs","generics","gh","gitcreds","glue","gt","highr","hms","htmltools","htmlwidgets","httr","httr2","hubAdmin","hubData","hubUtils","hubValidations","ini","jquerylib","jsonlite","jsonvalidate","juicyjuice","knitr","labeling","lifecycle","lubridate","magrittr","markdown","memoise","mime","MMWRweek","munsell","openssl","pillar","pkgconfig","purrr","R6","rappdirs","RColorBrewer","Rcpp","reactable","reactR","readr","rlang","rmarkdown","sass","scales","stringi","stringr","sys","tibble","tidyselect","timechange","tinytex","tzdb","utf8","V8","vctrs","viridisLite","vroom","whisker","withr","xfun","xml2","yaml","zoltr"],["17.0.0.1","1.2.1","0.2.1","1.5.0","0.1-3","1.4","0.2.0","4.5.0","4.5.2","1.0-9","0.8.0","1.1.0","2.3.2","3.6.3","0.8.0","2.1-1","1.9.2","0.3.2","1.5.3","5.2.3","1.16.2","0.6.37","1.1.4","1.0.1","1.0.6","2.1.2","1.2.0","0.5.2","1.6.5","0.1.3","1.4.1","0.1.2","1.8.0","0.11.1","0.11","1.1.3","0.5.8.1","1.6.4","1.4.7","1.0.5","1.3.0.9000","1.2.3","0.2.0.9000","0.7.1.9000","0.3.1","0.1.4","1.8.9","1.3.2","0.1.0","1.48","0.4.3","1.0.4","1.9.3","2.0.3","1.13","2.0.1","0.12","0.1.3","0.5.1","2.2.2","1.9.0","2.0.3","1.0.2","2.5.1","0.3.3","1.1-3","1.0.13","0.4.4","0.6.1","2.1.5","1.1.4","2.28","0.4.9","1.3.0","1.8.4","1.5.1","3.4.3","3.2.1","1.2.1","0.3.0","0.53","0.4.0","1.2.4","6.0.0","0.6.5","0.4.2","1.6.5","0.4.1","3.0.2","0.48","1.3.6","2.3.10","1.0.1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>package<\/th>\n      <th>version<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"name":"package","targets":0},{"name":"version","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="additional-dependencies">Additional dependencies<a class="anchor" aria-label="anchor" href="#additional-dependencies"></a>
</h3>
<p>If any custom functions you are deploying depend on additional
packages, you will need to ensure these packages are available during
validation.</p>
<p>The simplest way to ensure they are available is to edit the
<code>setup-r-dependencies</code> step in the
<code>hubverse-actions</code> <a href="https://github.com/hubverse-org/hubverse-actions/blob/main/validate-submission/validate-submission.yaml" class="external-link"><code>validate-submission.yaml</code></a>
GitHub Action workflow of your hub and add any additional dependency to
the <code>packages</code> field list.</p>
<p>In the following pseudo example we add <code>additionalPackage</code>
package to the list of standard dependencies:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r-dependencies@v2</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">          packages</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>            any::hubValidations</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>            any::sessioninfo</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>            any::additionalPackage</span></code></pre></div>
<p>Note that this ensures the additional dependency is available during
validation on GitHub but does not guarantee it will be installed locally
for hub administrators or submitting teams. Indeed such missing
dependencies could lead to execution errors in custom checks when
running <code><a href="../reference/validate_submission.html">validate_submission()</a></code> locally.</p>
<p>You could use documentation, like your hub’s README to communicate
additional required dependencies for validation to submitting teams.
Even better, you could add a check to the top of your function to catch
missing dependencies and provide a helpful error message to the
user.</p>
<div class="section level4">
<h4 id="deploying-custom-functions-as-a-package">Deploying custom functions as a package<a class="anchor" aria-label="anchor" href="#deploying-custom-functions-as-a-package"></a>
</h4>
<p>To deploy custom functions managed as a package in
<code>src/validations</code>, you can use the <code>pkg</code>
configuration property in the <code>validations.yml</code> file to
specify the package namespace.</p>
<p>For example, if you have created a simple package in
<code>src/validations/</code> with a
<code>cstm_check_tbl_example.R</code> script containing the
specification of an <code>cstm_check_tbl_example()</code> function in
<code>src/validations/R</code>, you can use the following configuration
in your <code>validation.yml</code> file to source the function from the
installed <code>validations</code> package namespace:</p>
<pre><code><span><span class="va">default</span><span class="op">:</span></span>
<span>    <span class="va">validate_model_data</span><span class="op">:</span></span>
<span>      <span class="va">custom_check</span><span class="op">:</span></span>
<span>        <span class="va">fn</span><span class="op">:</span> <span class="st">"cstm_check_tbl_example"</span></span>
<span>        <span class="va">pkg</span><span class="op">:</span> <span class="st">"validations"</span></span></code></pre>
<p>To ensure the package (and any additional dependencies it depends on)
is installed and available during validation, you must add the package
to the <code>setup-r-dependencies</code> step in the
<code>hubverse-actions</code> <code>validate-submission.yaml</code>
GitHub Action workflow of your hub like so:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> r-lib/actions/setup-r-dependencies@v2</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">          packages</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>            any::hubValidations</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>            any::sessioninfo</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>            local::./src/validations</span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anna Krystalli, Evan Ray, Hugo Gruson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1. PR Previews built by <a href="https://www.netlify.com" class="external-link">Netlify</a>. Provided without <strong>any warranty</strong>.</p>
</div>

    </footer>
</div>





  </body>
</html>
